<div class="formulario__container" data-controller="ia">
  <%= form_with(model: filme, id: "form_filme") do |form| %>
    <% if filme.errors.any? %>
      <div class="alert alert-danger">
        <h4><%= pluralize(filme.errors.count, "erro") %> proibiu este filme de ser salvo:</h4>
        <ul>
          <% filme.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="formulario__grupo">
      <%= form.label :poster, class: "formulario__label" %>
      <%= form.file_field :poster, class: "formulario__input" %>
    </div>

    <div class="formulario__grupo">
      <div class="d-flex flex-column flex-md-row gap-2 align-items-start align-items-md-end">
        <div class="flex-fill">
          <%= form.label :titulo, class: "formulario__label" %>
          <%= form.text_field :titulo, class: "formulario__input" %>
        </div>
        <div>
          <%= button_tag "Buscar por IA ✧₊⁺",
                         type: "button",
                         class: "botao botao--sucesso mt-2 mt-md-0",
                         data: { action: "click->ia#buscar" } %>
        </div>
      </div>
    </div>

    <div class="formulario__grupo">
      <%= form.label :sinopse, class: "formulario__label" %>
      <%= form.text_area :sinopse, class: "formulario__input", rows: 5 %>
    </div>

    <div class="formulario__grupo">
      <%= form.label :ano, class: "formulario__label" %>
      <%= form.number_field :ano, class: "formulario__input" %>
    </div>

    <div class="formulario__grupo">
      <%= form.label :duracao, class: "formulario__label" %>
      <%= form.number_field :duracao, class: "formulario__input" %>
    </div>

    <div class="formulario__grupo">
      <%= form.label :diretor, class: "formulario__label" %>
      <%= form.text_field :diretor, class: "formulario__input" %>
    </div>

    <div class="formulario__grupo">
      <%= form.label :categoria_ids, "Categorias", class: "formulario__label" %>
      <%= form.select :categoria_ids,
                      options_from_collection_for_select(Categoria.all, :id, :nome, filme.categoria_ids),
                      {},
                      { multiple: true, class: "form-select tom-select" } %>
    </div>

    <div class="formulario__grupo">
      <%= form.label :tags, "Tags", class: "formulario__label" %>
      <%= form.text_field :tags,
                          value: filme.tags.pluck(:nome).join(" "),
                          class: "formulario__input",
                          placeholder: "Separe as tags por espaço" %>
    </div>

    <div class="formulario__acoes">
      <%= form.submit "Salvar Filme", class: "botao botao--primario" %>
      <%= link_to "Voltar para filmes", filmes_path, class: "botao botao--secundario" %>
    </div>
  <% end %>
</div>